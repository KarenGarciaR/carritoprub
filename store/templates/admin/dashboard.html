{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Dashboard - ALM Refaccionaria{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
    .dashboard-container {
        background: #f8f9fa;
        min-height: 100vh;
        padding: 20px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid;
        transition: transform 0.2s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-card.orders { border-left-color: #007bff; }
    .stat-card.pending { border-left-color: #ffc107; }
    .stat-card.customers { border-left-color: #28a745; }
    .stat-card.products { border-left-color: #17a2b8; }
    .stat-card.revenue { border-left-color: #e83e8c; }
    .stat-card.low-stock { border-left-color: #dc3545; }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 20px;
        color: #495057;
    }
    
    .recent-orders, .low-stock-section {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .order-item, .product-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
    }
    
    .order-item:last-child, .product-item:last-child {
        border-bottom: none;
    }
    
    .order-info, .product-info {
        flex: 1;
    }
    
    .order-id, .product-name {
        font-weight: bold;
        color: #495057;
    }
    
    .order-customer, .product-stock {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
        color: white;
    }
    
    .status-pending { background: #ffc107; }
    .status-processing { background: #17a2b8; }
    .status-shipped { background: #007bff; }
    .status-delivered { background: #28a745; }
    .status-cancelled { background: #dc3545; }
    .status-Pendiente { background: #ffc107; }
    .status-Procesando { background: #17a2b8; }
    .status-Enviado { background: #007bff; }
    .status-Entregado { background: #28a745; }
    .status-Cancelado { background: #dc3545; }
    
    .quick-actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .quick-action-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        display: inline-block;
        transition: background 0.2s ease;
    }
    
    .quick-action-btn:hover {
        background: #0056b3;
        color: white;
        text-decoration: none;
    }
    
    .quick-action-btn.success { background: #28a745; }
    .quick-action-btn.success:hover { background: #1e7e34; }
    
    .quick-action-btn.warning { background: #ffc107; color: #212529; }
    .quick-action-btn.warning:hover { background: #e0a800; }
    
    .alert-info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1 class="section-title">üìä Dashboard de ALM Refaccionaria</h1>
    
    <div class="alert-info">
        <strong>¬°Bienvenido al panel de administraci√≥n mejorado!</strong> 
        Aqu√≠ puedes gestionar eficientemente todos los aspectos de tu tienda.
    </div>
    
    <!-- Estad√≠sticas principales -->
    <div class="stats-grid">
        <div class="stat-card orders">
            <div class="stat-number">{{ total_orders }}</div>
            <div class="stat-label">Total Pedidos</div>
        </div>
        
        <div class="stat-card pending">
            <div class="stat-number">{{ pending_orders }}</div>
            <div class="stat-label">Pedidos Pendientes</div>
        </div>
        
        <div class="stat-card customers">
            <div class="stat-number">{{ total_customers }}</div>
            <div class="stat-label">Clientes Registrados</div>
        </div>
        
        <div class="stat-card products">
            <div class="stat-number">{{ total_products }}</div>
            <div class="stat-label">Productos en Cat√°logo</div>
        </div>
        
        <div class="stat-card revenue">
            <div class="stat-number">${{ monthly_revenue|floatformat:2 }}</div>
            <div class="stat-label">Ingresos del Mes</div>
        </div>
        
        <div class="stat-card low-stock">
            <div class="stat-number">{{ low_stock_products }}</div>
            <div class="stat-label">Productos con Stock Bajo</div>
        </div>
    </div>
    
    <!-- Acciones r√°pidas -->
    <div class="quick-actions">
        <a href="{% url 'admin:store_order_changelist' %}" class="quick-action-btn">
            üìã Gestionar Pedidos
        </a>
        <a href="{% url 'admin:store_orderhistory_changelist' %}" class="quick-action-btn success">
            üìà Historial de Pedidos
        </a>
        <a href="{% url 'admin:store_product_changelist' %}" class="quick-action-btn warning">
            üõçÔ∏è Productos
        </a>
        <a href="{% url 'admin:store_customer_changelist' %}" class="quick-action-btn">
            üë• Clientes
        </a>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
        <!-- Pedidos recientes -->
        <div class="recent-orders">
            <h2 class="section-title">üì¶ Pedidos Recientes</h2>
            {% for history in recent_orders %}
                <div class="order-item">
                    <div class="order-info">
                        <div class="order-id">Pedido #{{ history.order.id }}</div>
                        <div class="order-customer">
                            {{ history.customer.name|default:history.order.customer.name|default:"Cliente Invitado" }}
                            - {{ history.created_at|date:"d/m/Y H:i" }}
                        </div>
                    </div>
                    <div class="status-badge status-{{ history.status }}">
                        {{ history.get_status_display }}
                    </div>
                </div>
            {% empty %}
                <p>No hay pedidos recientes.</p>
            {% endfor %}
        </div>
        
        <!-- Productos con stock bajo -->
        <div class="low-stock-section">
            <h2 class="section-title">‚ö†Ô∏è Stock Bajo</h2>
            {% for product in low_stock %}
                <div class="product-item">
                    <div class="product-info">
                        <div class="product-name">{{ product.name }}</div>
                        <div class="product-stock">Stock: {{ product.quantity }} unidades</div>
                    </div>
                    <span class="status-badge" style="background: {% if product.quantity == 0 %}#dc3545{% elif product.quantity <= 2 %}#fd7e14{% else %}#ffc107{% endif %};">
                        {% if product.quantity == 0 %}Sin Stock{% elif product.quantity <= 2 %}Cr√≠tico{% else %}Bajo{% endif %}
                    </span>
                </div>
            {% empty %}
                <p>‚úÖ Todos los productos tienen stock suficiente.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}